events {
    worker_connections 1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    # Logging
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    # Basic settings
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;

    server {
        listen 80;
        server_name localhost;

        # Health check endpoint
        location /health {
            add_header Content-Type application/json;
            return 200 '{"status":"healthy","service":"supabase-mcp-mock"}';
        }

        # Mock MCP endpoints
        location /query {
            add_header Content-Type application/json;
            add_header Access-Control-Allow-Origin *;
            add_header Access-Control-Allow-Methods "GET, POST, OPTIONS";
            add_header Access-Control-Allow-Headers "Content-Type, Authorization";

            if ($request_method = 'OPTIONS') {
                return 204;
            }

            # Mock response for database queries
            return 200 '{"result":"Mock query result - MCP server not implemented yet","tables":["hermes_vectors","conversations","sessions"]}';
        }

        location /tables {
            add_header Content-Type application/json;
            add_header Access-Control-Allow-Origin *;
            return 200 '{"tables":["hermes_vectors","conversations","sessions","users"]}';
        }

        location /tables/ {
            add_header Content-Type application/json;
            add_header Access-Control-Allow-Origin *;
            return 200 '{"table":"hermes_vectors","columns":[{"name":"id","type":"uuid"},{"name":"content","type":"text"},{"name":"metadata","type":"jsonb"},{"name":"embedding","type":"vector"}]}';
        }

        location /schema {
            add_header Content-Type application/json;
            add_header Access-Control-Allow-Origin *;
            return 200 '{"tables":{"hermes_vectors":{"columns":["id","content","metadata","embedding"]},"conversations":{"columns":["id","user_id","created_at"]}}}';
        }

        # Default response
        location / {
            add_header Content-Type application/json;
            return 200 '{"message":"Supabase MCP Server Mock","version":"1.0.0","endpoints":["/health","/query","/tables","/schema"]}';
        }
    }
}
